<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cmp.dao.CmpUserDao">

    <resultMap id="CmpUser" type="com.cmp.pojo.CmpUser" >
        <result column="openid" property="openid" jdbcType="VARCHAR" />
        <result column="nickname" property="nickname" jdbcType="VARCHAR" />
        <result column="province" property="province" jdbcType="VARCHAR" />
        <result column="city" property="city" jdbcType="VARCHAR" />
        <result column="country" property="country" jdbcType="VARCHAR" />
        <result column="address" property="address" jdbcType="VARCHAR" />
        <result column="headimgurl" property="headimgurl" jdbcType="VARCHAR" />
        <result column="subscribe" property="subscribe" jdbcType="TINYINT" />
        <result column="groupid" property="groupid" jdbcType="BIGINT" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="password" property="password" jdbcType="VARCHAR" />
        <result column="school" property="school" jdbcType="VARCHAR" />
        <result column="wx" property="wx" jdbcType="VARCHAR" />
        <result column="created" property="created" jdbcType="TIMESTAMP" />
    </resultMap>

    <!--用户自动注册-->
    <insert id="insert" parameterType="com.cmp.pojo.CmpUser">
        INSERT INTO cmp_user

        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="openid != null" >openid,</if>
            <if test="nickname != null" >nickname,</if>
            <if test="sex != null" >sex,</if>
            <if test="province != null" >province,</if>
            <if test="city != null" >city,</if>
            <if test="country != null" >country,</if>
            <if test="address != null" >address,</if>
            <if test="headimgurl != null" >headimgurl,</if>
            <if test="subscribe != null">subscribe,</if>
            <if test="groupid != null">groupid,</if>
            <if test="phone != null">phone,</if>
            <if test="password != null">password,</if>
            <if test="school != null">school,</if>
            <if test="wx != null">wx,</if>
            <if test="created != null">created,</if>
        </trim>

        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="openid != null" >#{openid},</if>
            <if test="nickname != null" >#{nickname},</if>
            <if test="sex != null" >#{sex},</if>
            <if test="province != null" >#{province},</if>
            <if test="city != null" >#{city},</if>
            <if test="country != null" >#{country},</if>
            <if test="address != null" >#{address},</if>
            <if test="headimgurl != null" >#{headimgurl},</if>
            <if test="subscribe != null">#{subscribe},</if>
            <if test="groupid != null">#{groupid},</if>
            <if test="phone != null">#{phone},</if>
            <if test="password != null">#{password},</if>
            <if test="school != null">#{school},</if>
            <if test="wx != null">#{wx},</if>
            <if test="created != null">#{created},</if>
        </trim>

    </insert>

    <!--根据微信名称返回用户 -->
    <select id="selectByWx" parameterType="string" resultMap="CmpUser">
        <!-- 这里并没有使用选取特定列的语句，因为返回的是整个CmpUser，是所有都选 -->
        SELECT * FROM cmp_user WHERE wx = #{wx}
    </select>

     <!--根据phone返回用户-->
    <select id="selectByPhone" parameterType="string" resultMap="CmpUser">
        <!-- 这里并没有使用选取特定列的语句，因为返回的是整个CmpUser，是所有都选 -->
        SELECT * FROM cmp_user WHERE phone = #{phone}
    </select>

    <!-- 根据openid返回用户 -->
    <select id="selectByOpenid" parameterType="string" resultMap="CmpUser">
        SELECT * FROM cmp_user WHERE openid = #{openid}
    </select>

    <!-- 根据微信号和密码进行登录 -->
    <select id="loginByWx" resultMap="CmpUser">
        SELECT * FROM cmp_user WHERE wx = #{wx} AND password = #{password}
    </select>

    <!-- 根据phone和密码返回用户 -->
    <select id="loginByPhone" resultMap="CmpUser">
        <!-- 这里并没有使用选取特定列的语句，因为返回的是整个CmpUser，是所有都选 -->
        SELECT * FROM cmp_user WHERE phone = #{phone} AND password = #{password}
    </select>

    <!-- 更新密码 -->
    <update id="updatePassword">
        UPDATE cmp_user SET password = #{password} WHERE phone = #{phone}
    </update>

    <!-- 更新用户的信息 -->
    <update id="update"  parameterType="com.cmp.pojo.CmpUser">
        UPDATE cmp_user
        <!-- 注册的微信号，注册时间，openid都是无法修改的 -->
        <trim prefix="set" suffixOverrides=",">
            <if test="nickname!=null">nickname = #{nickname},</if>
            <if test="sex!=null">sex = #{sex},</if>
            <if test="province!=null">province = #{province},</if>
            <if test="city!=null">city = #{city},</if>
            <if test="country!=null">country = #{country},</if>
            <if test="address!=null">address = #{address},</if>
            <if test="headimgurl!=null">headimgurl = #{headimgurl},</if>
            <if test="subscribe!=null">subscribe = #{subscribe},</if>
            <if test="groupid!=null">groupid = #{groupid},</if>
            <if test="phone!=null">phone = #{phone},</if>
            <if test="password!=null">password = #{password},</if>
            <if test="school!=null">school = #{school},</if>
        </trim>
        WHERE openid = #{openid}

    </update>


</mapper>